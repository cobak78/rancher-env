frontend {{ name }}
  mode http
  bind {{ ip }} {% if cert is not empty %}ssl crt {{ cert }}
  option httpclose
  option forwardfor
  reqadd X-Forwarded-Proto:\ https
  acl secure dst_port eq 443
  rsprep ^Set-Cookie:\ (.*) Set-Cookie:\ \1
  rspadd Strict-Transport-Security:\ max-age=31536000 if secure
{% endif %}

{% for backend in backends %}
  acl {{ backend.name|upper }} hdr_beg(host) {{ backend.domain }}
  use_backend {{ backend.name }} if {{ backend.name|upper }}
{% endfor %}
