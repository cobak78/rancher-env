global
  {% if global is not empty %}{{ global }}  {% endif %}chroot /var/lib/haproxy
  user haproxy
  group haproxy
  daemon
  tune.ssl.default-dh-param 2048
  ssl-default-bind-options no-sslv3
  ssl-default-bind-ciphers ECDHE+aRSA+AES256+GCM+SHA384:ECDHE+aRSA+AES128+GCM+SHA256:ECDHE+aRSA+AES256+SHA384:ECDHE+aRSA+AES128+SHA256:!ECDHE+aRSA+RC4+SHA:ECDHE+aRSA+AES256+SHA:ECDHE+aRSA+AES128+SHA:AES256+GCM+SHA384:AES128+GCM+SHA256:AES128+SHA256:AES256+SHA256:DHE+aRSA+AES128+SHA:!RC4+SHA:HIGH:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS

defaults
  mode http
  timeout connect 5000
  timeout client  50000
  timeout server  50000

{% if mailer_ip is not empty %} mailers mail-server
  mailer local {{ mailer_ip }}{% endif %}

{% for frontend in frontends %}
{{ frontend }}
{% endfor %}

userlist stats-auth
  group admin users admin
  user admin insecure-password vahJ5aeloah8
  group readonly users developer
  user developer insecure-password letsbonus

listen admin_page
  bind {{ haproxy_ip }}
  mode http
  stats show-desc {{ title }}
  stats show-node
  stats uri /stats
  stats show-legends
  stats refresh 10s
  acl AUTH http_auth(stats-auth)
  acl AUTH_ADMIN http_auth_group(stats-auth) admin
  stats http-request auth unless AUTH
  stats admin if AUTH_ADMIN

{% for backend in backends %}
{{ backend }}
{% endfor %}
